<% content_for :title, "Invoice" %>

<div class="max-w-2xl mx-auto bg-white shadow-lg rounded-lg p-8 mt-10 border border-gray-200">
  <!-- Header -->
  <div class="flex justify-between items-center border-b pb-4 mb-6">
    <div>
      <h1 class="text-xl font-bold text-gray-800">Invoice Pembayaran</h1>
      <p class="text-sm text-gray-600">Tanggal Dibuat: <%= l(@invoice.created_at.to_date, format: :long) %></p>
    </div>
    <div class="text-right">
      <p class="text-sm text-gray-600">Kode Invoice</p>
      <p class="text-base font-semibold text-gray-800">#INV-<%= @invoice.id.to_s.rjust(5, '0') %></p>
    </div>
  </div>

  <!-- Informasi Siswa -->
  <div class="mb-6">
    <h2 class="text-lg font-semibold text-gray-700 mb-2">Informasi Siswa</h2>
    <table class="w-full text-sm text-gray-700">
      <tr>
        <td class="font-medium w-1/3">Nama Siswa</td>
        <td>: <%= @invoice.student.name %></td>
      </tr>
      <tr>
        <td class="font-medium w-1/3">Nama Orangtua</td>
        <td>: <%= @invoice.student.parent_name %></td>
      </tr>
      <tr>
        <td class="font-medium">Contact</td>
        <td>: <%= @invoice.student.contact_person %></td>
      </tr>
      <tr>
        <td class="font-medium">Alamat</td>
        <td>: <%= @invoice.student.address.presence || "-" %></td>
      </tr>
    </table>
  </div>

  <!-- Rincian Invoice -->
  <div class="mb-6">
    <h2 class="text-lg font-semibold text-gray-700 mb-2">Rincian Pembayaran</h2>
    <table class="w-full text-sm text-gray-700 border border-gray-300">
      <thead class="bg-gray-100">
        <tr>
          <th class="p-2 text-left">Tanggal Pertemuan</th>
          <th class="p-2 text-left">Keterangan</th>
        </tr>
      </thead>
      <tbody>
        <% [@invoice.meeting_date_1, @invoice.meeting_date_2, @invoice.meeting_date_3, @invoice.meeting_date_4].each_with_index do |date, index| %>
          <% next if date.blank? %>
          <tr class="border-t">
            <td class="p-2"><%= l(date, format: :long) %></td>
            <td class="p-2">Pertemuan ke-<%= index + 1 %></td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>

  <!-- Total dan Status -->
  <div class="mb-6">
    <table class="w-full text-sm text-gray-700">
      <tr>
        <td class="font-medium w-1/2">Jumlah Tagihan</td>
        <td class="text-right font-bold text-indigo-700 text-lg">
          <%= number_to_currency(@invoice.amount, unit: "Rp. ", delimiter: ".", separator: ",") %>
        </td>
      </tr>
      <tr>
        <td class="font-medium">Status Pembayaran</td>
        <td class="text-right">
          <span class="inline-block px-3 py-1 rounded-full text-sm font-semibold
            <%= @invoice.paid? ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800' %>">
            <%= @invoice.status.humanize %>
          </span>
        </td>
      </tr>
    </table>
  </div>

  <!-- Tanda Tangan -->
  <div class="flex justify-between items-end mt-10">
    <div>
      <p class="text-sm text-gray-600">Dibuat oleh:</p>
      <p class="font-semibold text-gray-800 mt-10 underline"><%= @invoice.user.name.presence || "Admin" %></p>
    </div>
    <div class="text-right">
      <p class="text-sm text-gray-600">Diterima oleh:</p>
      <p class="font-semibold text-gray-800 mt-10 underline"><%= @invoice.student.parent_name.presence || "Orang Tua/Wali" %></p>
    </div>
  </div>
</div>

<div class="flex justify-end mb-4">
  <%= link_to "Download PDF", pdf_admin_invoice_path(@invoice),
      class: "bg-indigo-600 hover:bg-indigo-700 text-white font-semibold px-4 py-2 rounded",
      target: "_blank" %>
</div>

